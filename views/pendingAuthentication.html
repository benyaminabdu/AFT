<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Authentication Pending</title>
        <style>
            body { margin: 0; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
            body > iframe { display: block; }
            #step-up-form { position: absolute; left: -9999px; }
        </style>
    </head>
    <body>
        <iframe name=”step-up-iframe" width="{{ challengeWidth }}" height="{{ challengeHeight }}"></iframe>
        <form id="step-up-form" target=”step-up-iframe" method="post" action="{{ stepUpUrl }}">
            <input 
                type="hidden" 
                name="JWT" 
                value="{{ challengeAccessToken }}" 
            />
            <input type="hidden" name="MD" value="{{ reference }}"/>
        </form>

        <script>
            var REDIRECT_TRIGGER_URL_KEYWORD = 'webhook.site';
            
            function onRedirectTrigger() {
                console.log('Redirect trigger: iframe matched or postMessage received');
            }

            window.onload = function() {
                var stepUpForm = document.querySelector('#step-up-form');
                if (stepUpForm) {
                    stepUpForm.submit();
                }

                var iframe = document.querySelector('iframe[name="step-up-iframe"]');
                if (iframe) {
                    iframe.addEventListener('load', function() {
                        try {
                            var href = iframe.contentWindow.location.href;
                            if (href && href.indexOf(REDIRECT_TRIGGER_URL_KEYWORD) !== -1) {
                                onRedirectTrigger();
                            }
                        } catch (e) {
                            // Cross-origin: cannot read iframe URL. Use postMessage from the page inside the iframe.
                        }
                    });
                }

                window.addEventListener('message', function(e) {
                    if (e.data && (e.data.type === 'REDIRECT_BACK' || e.data.redirectBack === true)) {
                        onRedirectTrigger();
                    }
                });
            };
        </script>

    </body>
</html>